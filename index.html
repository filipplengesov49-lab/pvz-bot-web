<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å –ü–í–ó</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #f0f9ff; /* –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π —Ñ–æ–Ω */
      color: #1e293b;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: #dbeafe;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 22px;
      font-weight: 600;
      color: #3b82f6;
    }
    
    .stat-label {
      font-size: 13px;
      color: #64748b;
      margin-top: 4px;
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .btn {
      padding: 14px 10px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
      min-height: 50px; /* –ï–¥–∏–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ */
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-primary {
      background: #1e40af; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π –¥–ª—è –ü–í–ó */
    }
    
    .btn-secondary {
      background: #15803d; /* –¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */
    }
    
    .btn-success {
      background: #1e40af; /* –¢—ë–º–Ω–æ-—Å–∏–Ω–∏–π –¥–ª—è –ü–í–ó */
    }
    
    .btn-warning {
      background: #15803d; /* –¢—ë–º–Ω–æ-–∑–µ–ª—ë–Ω—ã–π –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */
    }
    
    .btn-danger {
      background: #b91c1c;
    }
    
    .btn-back {
      background: #94a3b8;
    }
    
    .btn-edit {
      background: #f59e0b;
    }
    
    .calendar-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      position: relative;
    }
    
    .point-address-header {
      background: #dbeafe;
      color: #1e40af;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 500;
      font-size: 14px;
    }
    
    .calendar {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    
    .month-header {
      text-align: center;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #1e293b;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .month-nav {
      background: #1e40af;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background 0.2s;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .month-nav:hover {
      background: #1d4ed8;
    }
    
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: 500;
      color: #64748b;
      margin-bottom: 10px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    
    .day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      position: relative;
      overflow: hidden;
      background: #f1f5f9;
      color: #1e293b;
    }
    
    .day:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .day.empty {
      background: transparent;
      cursor: default;
    }
    
    .day.free {
      background: #fee2e2;
      color: #b91c1c;
    }
    
    .day.busy {
      background: #dcfce7;
      color: #155e75;
    }
    
    .day.today {
      border: 2px solid #3b82f6;
      background: #dbeafe !important;
      color: #1e40af;
    }
    
    .day.today.free {
      background: #fecaca !important;
    }
    
    .day.today.busy {
      background: #bbf7d0 !important;
    }
    
    .day-number {
      position: relative;
      z-index: 1;
    }
    
    /* –ü–æ–ø-–∞–ø –æ–∫–Ω–∞ */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .popup.active {
      opacity: 1;
      pointer-events: all;
    }
    
    .popup-content {
      background: white;
      border-radius: 12px;
      padding: 22px;
      width: 90%;
      max-width: 450px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transform: translateY(20px);
      transition: transform 0.3s;
    }
    
    .popup.active .popup-content {
      transform: translateY(0);
    }
    
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .popup h3 {
      margin: 0;
      color: #1e293b;
      font-size: 18px;
      font-weight: 600;
    }
    
    .popup-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #94a3b8;
      padding: 5px;
    }
    
    .popup-close:hover {
      color: #1e293b;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #334155;
      font-size: 14px;
      font-weight: 500;
    }
    
    .form-group input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 15px;
      color: #1e293b;
      background: white;
      transition: border-color 0.2s;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .form-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    .points-list, .employees-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .point-item, .employee-item {
      background: white;
      padding: 12px 15px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s;
      border: 1px solid #e2e8f0;
    }
    
    .point-item:hover, .employee-item:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    
    .point-info, .employee-info {
      flex: 1;
    }
    
    .point-name, .employee-name {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
      font-size: 15px;
    }
    
    .point-address, .employee-details {
      color: #64748b;
      font-size: 13px;
    }
    
    .point-actions, .employee-actions {
      display: flex;
      gap: 8px;
      min-width: 90px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
    }
    
    .action-btn {
      width: 36px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
      height: 36px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: all 0.2s;
    }
    
    .action-btn.delete {
      background: #fee2e2;
      color: #b91c1c;
    }
    
    .action-btn.calendar {
      background: #dbeafe;
      color: #1e40af;
    }
    
    .action-btn.edit {
      background: #fef3c7;
      color: #b45309;
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 2000;
      transition: transform 0.3s;
      font-weight: 500;
      color: #1e293b;
      border-left: 4px solid #3b82f6;
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success {
      border-left-color: #22c55e;
    }
    
    .toast.error {
      border-left-color: #ef4444;
    }
    
    .toast.warning {
      border-left-color: #f59e0b;
    }
    
    .confirm-popup {
      text-align: center;
      padding: 20px 0;
    }
    
    .confirm-popup p {
      margin-bottom: 20px;
      color: #64748b;
      font-size: 15px;
    }
    
    .confirm-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .empty-state {
      text-align: center;
      color: #94a3b8;
      padding: 40px 20px;
    }
    
    .empty-state h4 {
      margin-bottom: 10px;
      color: #64748b;
    }
    
    .empty-state p {
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .tag-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .tag-btn {
      padding: 6px 12px;
      border: 1px solid #e2e8f0;
      background: #f1f5f9;
      color: #334155;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .tag-btn.selected {
      background: #1e40af;
      color: white;
      border-color: #1e40af;
    }
    
    .tag-btn:hover {
      background: #e2e8f0;
      color: #1e293b;
    }
    
    .recommended-badge {
      background: #f59e0b;
      color: white;
      padding: 3px 7px;
      border-radius: 10px;
      font-size: 11px;
      margin-left: 8px;
      font-weight: 500;
    }
    
    .no-calendar {
      background: white;
      border-radius: 12px;
      padding: 30px 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .no-calendar p {
      color: #64748b;
      font-size: 15px;
      margin-top: 10px;
    }
    
    .no-calendar-icon {
      font-size: 48px;
      margin-bottom: 15px;
      color: #94a3b8;
    }
    
    .export-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
    }
    
    .export-section .btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="points-count">0</div>
          <div class="stat-label">–ü—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="employees-count">0</div>
          <div class="stat-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
        </div>
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="showAddPointPopup()">
        –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏
      </button>
      <button class="btn btn-secondary" onclick="showAddEmployeePopup()">
        –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      </button>
      <button class="btn btn-success" onclick="showPointsList()">
        –ú–æ–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏
      </button>
      <button class="btn btn-warning" onclick="showEmployeesList()">
        –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
      </button>
    </div>
    
    <div class="calendar-container">
      <div id="calendar-placeholder" class="no-calendar">
        <div class="no-calendar-icon">üìÖ</div>
        <h3>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</h3>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞</p>
      </div>
      
      <div id="calendar-content" style="display: none;">
        <div class="point-address-header" id="point-address-header">
          –ê–¥—Ä–µ—Å –ø—É–Ω–∫—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å
        </div>
        
        <div class="calendar">
          <div class="month-header">
            <button class="month-nav" onclick="changeMonth(-1)">‚ùÆ</button>
            <div id="month-name">–Ø–Ω–≤–∞—Ä—å 2026</div>
            <button class="month-nav" onclick="changeMonth(1)">‚ùØ</button>
          </div>
          <div class="weekdays">
            <div>–ü–Ω</div>
            <div>–í—Ç</div>
            <div>–°—Ä</div>
            <div>–ß—Ç</div>
            <div>–ü—Ç</div>
            <div>–°–±</div>
            <div>–í—Å</div>
          </div>
          <div class="days" id="days-container">
            <!-- –î–Ω–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
          </div>
        </div>
      </div>
    </div>
    
    <div class="export-section">
      <button class="btn btn-warning" onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ü–í–ó -->
  <div class="popup" id="add-point-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="point-popup-title">–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h3>
        <button class="popup-close" onclick="closePopup('add-point-popup')">√ó</button>
      </div>
      <div class="form-group">
        <label for="point-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ *</label>
        <input type="text" id="point-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–í–ó –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π" maxlength="100">
      </div>
      <div class="form-group">
        <label for="point-address">–ê–¥—Ä–µ—Å –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ *</label>
        <input type="text" id="point-address" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, 10">
      </div>
      <div class="form-actions">
        <button class="btn btn-back" onclick="closePopup('add-point-popup')">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" id="point-save-btn" onclick="savePoint()">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
  <div class="popup" id="add-employee-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="employee-popup-title">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <button class="popup-close" onclick="closePopup('add-employee-popup')">√ó</button>
      </div>
      <div class="form-group">
        <label for="employee-name">–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</label>
        <input type="text" id="employee-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" maxlength="100">
      </div>
      <div class="form-group">
        <label for="employee-phone">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
        <input type="tel" id="employee-phone" placeholder="+7 (123) 456-78-90" maxlength="20" 
               oninput="validatePhone(this)">
      </div>
      <div class="form-group">
        <label for="employee-rate">–°—Ç–∞–≤–∫–∞ –∑–∞ –¥–µ–Ω—å (‚ÇΩ)</label>
        <input type="number" id="employee-rate" placeholder="1000" value="1000" min="0">
      </div>
      <div class="form-group">
        <label>–¢–µ–≥–∏ –ø–æ –ø—É–Ω–∫—Ç–∞–º (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)</label>
        <div class="tag-selector" id="point-tags-selector">
          <!-- –¢–µ–≥–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-back" onclick="closePopup('add-employee-popup')">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-secondary" id="employee-save-btn" onclick="saveEmployee()">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø —Å–ø–∏—Å–∫–∞ –ü–í–ó -->
  <div class="popup" id="points-list-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–ú–æ–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h3>
        <button class="popup-close" onclick="closePopup('points-list-popup')">√ó</button>
      </div>
      <div class="points-list" id="points-list">
        <!-- –°–ø–∏—Å–æ–∫ –ü–í–ó –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
  <div class="popup" id="employees-list-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h3>
        <button class="popup-close" onclick="closePopup('employees-list-popup')">√ó</button>
      </div>
      <div class="employees-list" id="employees-list">
        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
  <div class="popup" id="confirm-delete-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <button class="popup-close" onclick="closePopup('confirm-delete-popup')">√ó</button>
      </div>
      <div class="confirm-popup">
        <p id="confirm-delete-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç?</p>
        <div class="confirm-actions">
          <button class="btn btn-back" onclick="closePopup('confirm-delete-popup')">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-danger" id="confirm-delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞ -->
  <div class="popup" id="confirm-duplicate-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–í–Ω–∏–º–∞–Ω–∏–µ</h3>
        <button class="popup-close" onclick="closePopup('confirm-duplicate-popup')">√ó</button>
      </div>
      <div class="confirm-popup">
        <p id="confirm-duplicate-message">–¢–∞–∫–æ–π –ø—É–Ω–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?</p>
        <div class="confirm-actions">
          <button class="btn btn-back" onclick="closePopup('confirm-duplicate-popup')">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-primary" id="confirm-add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
  <div class="popup" id="day-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="popup-date">27 —è–Ω–≤–∞—Ä—è</h3>
        <button class="popup-close" onclick="closePopup('day-popup')">√ó</button>
      </div>
      <div style="text-align: center; padding: 20px;">
        <div style="font-size: 42px; margin-bottom: 15px; color: #64748b;">üìÖ</div>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 15px;">
          –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã
        </p>
        <div id="day-employees-list">
          <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ -->
        </div>
        <div id="day-assigned-employee" style="display: none; margin-top: 20px;">
          <p style="color: #22c55e; font-weight: 600; margin-bottom: 10px;">‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω:</p>
          <div id="assigned-employee-name" style="font-size: 17px; margin-bottom: 15px; color: #1e293b;"></div>
          <div style="display: flex; justify-content: center;">
            <button class="btn btn-danger" onclick="clearDayAssignment()">–û—á–∏—Å—Ç–∏—Ç—å –¥–µ–Ω—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="toast" id="toast"></div>
  
  <script>
    // ===== –•–†–ê–ù–ò–õ–ò–©–ï –î–ê–ù–ù–´–• (localStorage) =====
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();
    let currentPointId = null; // ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞
    let points = JSON.parse(localStorage.getItem('pvz_points')) || [];
    let employees = JSON.parse(localStorage.getItem('pvz_employees')) || [];
    let schedule = JSON.parse(localStorage.getItem('pvz_schedule')) || []; // { pointId, employeeId, date }
    let employeeTags = JSON.parse(localStorage.getItem('pvz_employee_tags')) || {}; // { employeeId: [pointId1, pointId2] }
    let editingPointId = null; // ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—É–Ω–∫—Ç–∞
    let editingEmployeeId = null; // ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    
    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
    document.addEventListener('DOMContentLoaded', () => {
      updateStats();
      updateCalendarView();
    });
    
    // ===== –í–ê–õ–ò–î–ê–¶–ò–Ø –¢–ï–õ–ï–§–û–ù–ê =====
    function validatePhone(input) {
      // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª—ã —Ñ–æ—Ä–º–∞—Ç–∞
      let value = input.value.replace(/[^+0-9() -]/g, '');
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
      if (value.length > 20) {
        value = value.substring(0, 20);
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
      if (value.startsWith('+7') && value.length === 3) {
        value += ' (';
      } else if (value.startsWith('+7 (') && value.length === 6) {
        value += ')';
      } else if (value.startsWith('+7 ()') && value.length === 7) {
        value = '+7 (';
      } else if (value.startsWith('+7 (') && value.length === 10) {
        value += ' ';
      } else if (value.startsWith('+7 (') && value.length === 14) {
        value += '-';
      } else if (value.startsWith('+7 (') && value.length === 17) {
        value += '-';
      }
      
      input.value = value;
    }
    
    // ===== –ö–ê–õ–ï–ù–î–ê–†–¨ =====
    const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å",
      "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
    
    function generateCalendar(year, month) {
      currentYear = year;
      currentMonth = month;
      
      document.getElementById('month-name').textContent = `${monthNames[month]} ${year}`;
      
      const daysContainer = document.getElementById('days-container');
      daysContainer.innerHTML = '';
      
      const firstDay = new Date(year, month, 1).getDay() || 7; // –ü–Ω = 1, –í—Å = 7
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      const isCurrentMonth = year === today.getFullYear() && month === today.getMonth();
      
      // –ü—É—Å—Ç—ã–µ –¥–Ω–∏ –¥–æ –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
      for (let i = 1; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.className = 'day empty';
        daysContainer.appendChild(empty);
      }
      
      // –î–Ω–∏ –º–µ—Å—è—Ü–∞
      for (let day = 1; day <= daysInMonth; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayEl.appendChild(dayNumber);
        
        const dateStr = formatDate(year, month, day);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –≤ –≥—Ä–∞—Ñ–∏–∫–µ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ü–í–ó
        const isScheduled = currentPointId && schedule.some(s => 
          s.pointId === currentPointId && s.date === dateStr
        );
        
        dayEl.classList.add(isScheduled ? 'busy' : 'free');
        
        // –°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
        if (isCurrentMonth && day === today.getDate()) {
          dayEl.classList.add('today');
        }
        
        // –ö–ª–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ü–í–ó
        if (currentPointId) {
          dayEl.onclick = () => showDayPopup(day, month, year);
        }
        
        daysContainer.appendChild(dayEl);
      }
    }
    
    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      generateCalendar(currentYear, currentMonth);
    }
    
    function formatDate(year, month, day) {
      return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }
    
    // ===== –ü–û–ü-–ê–ü –û–ö–ù–ê =====
    function showPopup(id) {
      document.getElementById(id).classList.add('active');
    }
    
    function closePopup(id) {
      document.getElementById(id).classList.remove('active');
    }
    
    function showAddPointPopup() {
      editingPointId = null;
      document.getElementById('point-name').value = '';
      document.getElementById('point-address').value = '';
      document.getElementById('point-popup-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏';
      document.getElementById('point-save-btn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
      document.getElementById('point-save-btn').className = 'btn btn-primary';
      showPopup('add-point-popup');
    }
    
    function showEditPointPopup(pointId) {
      const point = points.find(p => p.id === pointId);
      if (!point) return;
      
      editingPointId = pointId;
      document.getElementById('point-name').value = point.name;
      document.getElementById('point-address').value = point.address;
      document.getElementById('point-popup-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏';
      document.getElementById('point-save-btn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      document.getElementById('point-save-btn').className = 'btn btn-edit';
      showPopup('add-point-popup');
    }
    
    function savePoint() {
      const name = document.getElementById('point-name').value.trim();
      const address = document.getElementById('point-address').value.trim();
      
      if (!name || name.length < 2) {
        showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (!address || address.length < 5) {
        showToast('–ê–¥—Ä–µ—Å –ü–í–ó –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (editingPointId) {
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—É–Ω–∫—Ç–∞
        const index = points.findIndex(p => p.id === editingPointId);
        if (index !== -1) {
          points[index].name = name;
          points[index].address = address;
          localStorage.setItem('pvz_points', JSON.stringify(points));
          closePopup('add-point-popup');
          showToast('‚úÖ –ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
          renderPointsList();
          updateCalendarView();
        }
      } else {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—É–Ω–∫—Ç–∞
        addPoint();
      }
    }
    
    function addPoint() {
      const name = document.getElementById('point-name').value.trim();
      const address = document.getElementById('point-address').value.trim();
      
      if (!name || name.length < 2) {
        showToast('–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (!address || address.length < 5) {
        showToast('–ê–¥—Ä–µ—Å –ü–í–ó –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
      const existingPoint = points.find(p => 
        p.name.toLowerCase() === name.toLowerCase() || 
        p.address.toLowerCase() === address.toLowerCase()
      );
      
      if (existingPoint) {
        document.getElementById('confirm-duplicate-message').textContent = 
          `–ü—É–Ω–∫—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "${name}" –∏–ª–∏ –∞–¥—Ä–µ—Å–æ–º "${address}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?`;
        
        document.getElementById('confirm-add-btn').onclick = () => {
          doAddPoint(name, address);
          closePopup('confirm-duplicate-popup');
        };
        
        showPopup('confirm-duplicate-popup');
        return;
      }
      
      doAddPoint(name, address);
    }
    
    function doAddPoint(name, address) {
      const newPoint = {
        id: points.length > 0 ? Math.max(...points.map(p => p.id)) + 1 : 1,
        name: name,
        address: address
      };
      
      points.push(newPoint);
      localStorage.setItem('pvz_points', JSON.stringify(points));
      
      closePopup('add-point-popup');
      showToast('‚úÖ –ü–í–ó –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
      updateStats();
      renderPointsList();
      updateCalendarView();
    }
    
    function showAddEmployeePopup() {
      editingEmployeeId = null;
      document.getElementById('employee-name').value = '';
      document.getElementById('employee-phone').value = '';
      document.getElementById('employee-rate').value = '1000';
      document.getElementById('employee-popup-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
      document.getElementById('employee-save-btn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
      document.getElementById('employee-save-btn').className = 'btn btn-secondary';
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–≥–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤
      const tagsContainer = document.getElementById('point-tags-selector');
      if (points.length === 0) {
        tagsContainer.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</p>';
      } else {
        let html = '';
        points.forEach(point => {
          html += `
            <button class="tag-btn" onclick="toggleTag(this, ${point.id})">
              ${point.name}
            </button>
          `;
        });
        tagsContainer.innerHTML = html;
      }
      
      showPopup('add-employee-popup');
    }
    
    function showEditEmployeePopup(employeeId) {
      const employee = employees.find(e => e.id === employeeId);
      if (!employee) return;
      
      editingEmployeeId = employeeId;
      document.getElementById('employee-name').value = employee.name;
      document.getElementById('employee-phone').value = employee.phone || '';
      document.getElementById('employee-rate').value = employee.rate;
      document.getElementById('employee-popup-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
      document.getElementById('employee-save-btn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      document.getElementById('employee-save-btn').className = 'btn btn-edit';
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–≥–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤
      const tagsContainer = document.getElementById('point-tags-selector');
      if (points.length === 0) {
        tagsContainer.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</p>';
      } else {
        let html = '';
        points.forEach(point => {
          const isSelected = employeeTags[employeeId] && employeeTags[employeeId].includes(point.id);
          html += `
            <button class="tag-btn ${isSelected ? 'selected' : ''}" onclick="toggleTag(this, ${point.id})">
              ${point.name}
            </button>
          `;
        });
        tagsContainer.innerHTML = html;
      }
      
      showPopup('add-employee-popup');
    }
    
    function saveEmployee() {
      const name = document.getElementById('employee-name').value.trim();
      const phone = document.getElementById('employee-phone').value.trim();
      const rate = parseFloat(document.getElementById('employee-rate').value) || 1000;
      
      if (!name || name.length < 2) {
        showToast('–§–ò–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (editingEmployeeId) {
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        const index = employees.findIndex(e => e.id === editingEmployeeId);
        if (index !== -1) {
          employees[index].name = name;
          employees[index].phone = phone;
          employees[index].rate = rate;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–≥–∏
          const selectedTags = Array.from(document.querySelectorAll('#point-tags-selector .tag-btn.selected'));
          const tags = selectedTags.map(btn => parseInt(btn.getAttribute('onclick').match(/\d+/)[0]));
          if (tags.length > 0) {
            employeeTags[editingEmployeeId] = tags;
          } else {
            delete employeeTags[editingEmployeeId];
          }
          
          localStorage.setItem('pvz_employees', JSON.stringify(employees));
          localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
          
          closePopup('add-employee-popup');
          showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
          renderEmployeesList();
        }
      } else {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        addEmployee();
      }
    }
    
    function addEmployee() {
      const name = document.getElementById('employee-name').value.trim();
      const phone = document.getElementById('employee-phone').value.trim();
      const rate = parseFloat(document.getElementById('employee-rate').value) || 1000;
      
      if (!name || name.length < 2) {
        showToast('–§–ò–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç –ø–æ –∏–º–µ–Ω–∏
      const existingEmployee = employees.find(e => e.name.toLowerCase() === name.toLowerCase());
      
      if (existingEmployee) {
        document.getElementById('confirm-duplicate-message').textContent = 
          `–°–æ—Ç—Ä—É–¥–Ω–∏–∫ "${name}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?`;
        
        document.getElementById('confirm-add-btn').onclick = () => {
          doAddEmployee(name, phone, rate);
          closePopup('confirm-duplicate-popup');
        };
        
        showPopup('confirm-duplicate-popup');
        return;
      }
      
      doAddEmployee(name, phone, rate);
    }
    
    function doAddEmployee(name, phone, rate) {
      const newEmployee = {
        id: employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1,
        name: name,
        phone: phone,
        rate: rate
      };
      
      employees.push(newEmployee);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–≥–∏
      const selectedTags = Array.from(document.querySelectorAll('#point-tags-selector .tag-btn.selected'));
      const tags = selectedTags.map(btn => parseInt(btn.getAttribute('onclick').match(/\d+/)[0]));
      if (tags.length > 0) {
        employeeTags[newEmployee.id] = tags;
      }
      
      localStorage.setItem('pvz_employees', JSON.stringify(employees));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      closePopup('add-employee-popup');
      showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
      updateStats();
      renderEmployeesList();
    }
    
    function toggleTag(btn, pointId) {
      btn.classList.toggle('selected');
    }
    
    function showPointsList() {
      renderPointsList();
      showPopup('points-list-popup');
    }
    
    function showEmployeesList() {
      renderEmployeesList();
      showPopup('employees-list-popup');
    }
    
    function showDayPopup(day, month, year) {
      const dateStr = formatDate(year, month, day);
      document.getElementById('popup-date').textContent = `${day} ${monthNames[month].toLowerCase()} ${year}`;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞
      const listEl = document.getElementById('day-employees-list');
      const assignedEl = document.getElementById('day-assigned-employee');
      const assignedNameEl = document.getElementById('assigned-employee-name');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–∑–Ω–∞—á–µ–Ω –ª–∏ —É–∂–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
      const existing = schedule.find(s => s.pointId === currentPointId && s.date === dateStr);
      
      if (existing) {
        const employee = employees.find(e => e.id === existing.employeeId);
        assignedNameEl.textContent = employee ? employee.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
        assignedEl.style.display = 'block';
        listEl.style.display = 'none';
      } else {
        assignedEl.style.display = 'none';
        listEl.style.display = 'block';
        
        if (employees.length === 0) {
          listEl.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>';
        } else {
          // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –ü–í–ó
          const sortedEmployees = [...employees].sort((a, b) => {
            const aHasTag = employeeTags[a.id] && employeeTags[a.id].includes(currentPointId);
            const bHasTag = employeeTags[b.id] && employeeTags[b.id].includes(currentPointId);
            return bHasTag - aHasTag; // –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ –≤–≤–µ—Ä—Ö—É
          });
          
          let html = '';
          sortedEmployees.forEach(emp => {
            const isRecommended = employeeTags[emp.id] && employeeTags[emp.id].includes(currentPointId);
            html += `
              <div class="employee-item" onclick="assignEmployeeToDay(${emp.id}, '${dateStr}')">
                <div class="employee-info">
                  <div class="employee-name">
                    ${emp.name}
                    ${isRecommended ? '<span class="recommended-badge">‚òÖ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω</span>' : ''}
                  </div>
                  <div class="employee-details">${emp.phone || ''} ‚Ä¢ ${emp.rate}‚ÇΩ/–¥–µ–Ω—å</div>
                </div>
                <div style="font-size: 20px; color: #64748b;">‚û°Ô∏è</div>
              </div>
            `;
          });
          listEl.innerHTML = html;
        }
      }
      
      showPopup('day-popup');
    }
    
    // ===== –£–î–ê–õ–ï–ù–ò–ï –ü–í–ó =====
    function confirmDeletePoint(pointId) {
      const point = points.find(p => p.id === pointId);
      document.getElementById('confirm-delete-message').textContent = 
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${point.name}"? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`;
      
      document.getElementById('confirm-delete-btn').onclick = () => {
        deletePoint(pointId);
        closePopup('confirm-delete-popup');
      };
      
      showPopup('confirm-delete-popup');
    }
    
    function deletePoint(pointId) {
      // –£–¥–∞–ª—è–µ–º —Å–∞–º –ü–í–ó
      points = points.filter(p => p.id !== pointId);
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ –ü–í–ó
      schedule = schedule.filter(s => s.pointId !== pointId);
      
      // –£–¥–∞–ª—è–µ–º —Ç–µ–≥–∏ –¥–ª—è —ç—Ç–æ–≥–æ –ü–í–ó —É –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
      for (let empId in employeeTags) {
        employeeTags[empId] = employeeTags[empId].filter(pid => pid !== pointId);
        if (employeeTags[empId].length === 0) {
          delete employeeTags[empId];
        }
      }
      
      localStorage.setItem('pvz_points', JSON.stringify(points));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –ü–í–ó, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
      if (currentPointId === pointId) {
        currentPointId = null;
        updateCalendarView();
      }
      
      showToast('‚úÖ –ü–í–ó —É–¥–∞–ª—ë–Ω!', 'success');
      updateStats();
      renderPointsList();
    }
    
    // ===== –£–î–ê–õ–ï–ù–ò–ï –°–û–¢–†–£–î–ù–ò–ö–ê =====
    function confirmDeleteEmployee(employeeId) {
      const employee = employees.find(e => e.id === employeeId);
      document.getElementById('confirm-delete-message').textContent = 
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${employee.name}"? –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`;
      
      document.getElementById('confirm-delete-btn').onclick = () => {
        deleteEmployee(employeeId);
        closePopup('confirm-delete-popup');
      };
      
      showPopup('confirm-delete-popup');
    }
    
    function deleteEmployee(employeeId) {
      // –£–¥–∞–ª—è–µ–º —Å–∞–º–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      employees = employees.filter(e => e.id !== employeeId);
      
      // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      schedule = schedule.filter(s => s.employeeId !== employeeId);
      
      // –£–¥–∞–ª—è–µ–º —Ç–µ–≥–∏
      delete employeeTags[employeeId];
      
      localStorage.setItem('pvz_employees', JSON.stringify(employees));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª—ë–Ω!', 'success');
      updateStats();
      renderEmployeesList();
    }
    
    // ===== –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï –°–û–¢–†–£–î–ù–ò–ö–ê –ù–ê –î–ï–ù–¨ =====
    function assignEmployeeToDay(employeeId, dateStr) {
      if (!currentPointId) {
        showToast('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏', 'error');
        return;
      }
      
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
      schedule = schedule.filter(s => !(s.pointId === currentPointId && s.date === dateStr));
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
      schedule.push({
        pointId: currentPointId,
        employeeId: employeeId,
        date: dateStr
      });
      
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      
      const employee = employees.find(e => e.id === employeeId);
      showToast(`üìÖ ${employee.name} –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ ${dateStr}`, 'success');
      closePopup('day-popup');
      generateCalendar(currentYear, currentMonth);
    }
    
    // ===== –û–ß–ò–°–¢–ö–ê –î–ù–Ø =====
    function clearDayAssignment() {
      const dateStr = document.getElementById('popup-date').textContent;
      // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞—Ç—É –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ "27 —è–Ω–≤–∞—Ä—è 2026"
      const [day, monthName, year] = dateStr.split(' ');
      const monthIndex = monthNames.findIndex(m => m.toLowerCase() === monthName);
      const fullDate = formatDate(parseInt(year), monthIndex, parseInt(day));
      
      schedule = schedule.filter(s => !(s.pointId === currentPointId && s.date === fullDate));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      
      showToast('‚úÖ –î–µ–Ω—å –æ—á–∏—â–µ–Ω', 'success');
      closePopup('day-popup');
      generateCalendar(currentYear, currentMonth);
    }
    
    // ===== –í–´–ë–û–† –ü–í–ó –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø =====
    function selectPointForEditing(pointId) {
      const point = points.find(p => p.id === pointId);
      currentPointId = pointId;
      
      updateCalendarView();
      closePopup('points-list-popup');
      showToast(`‚úÖ –í—ã–±—Ä–∞–Ω: ${point.name}`, 'success');
    }
    
    // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–ò–î–ê –ö–ê–õ–ï–ù–î–ê–†–Ø =====
    function updateCalendarView() {
      const placeholder = document.getElementById('calendar-placeholder');
      const content = document.getElementById('calendar-content');
      const addressHeader = document.getElementById('point-address-header');
      
      if (!currentPointId) {
        // –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
        placeholder.style.display = 'block';
        content.style.display = 'none';
      } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
        const point = points.find(p => p.id === currentPointId);
        addressHeader.textContent = point.address;
        
        placeholder.style.display = 'none';
        content.style.display = 'block';
        
        generateCalendar(currentYear, currentMonth);
      }
    }
    
    // ===== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ü–ò–°–ö–û–í =====
    function renderPointsList() {
      const listEl = document.getElementById('points-list');
      
      if (points.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <h4>–ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h4>
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      points.forEach(point => {
        html += `
          <div class="point-item">
            <div class="point-info" onclick="selectPointForEditing(${point.id})">
              <div class="point-name">${point.name}</div>
              <div class="point-address">${point.address}</div>
            </div>
            <div class="point-actions">
              <button class="action-btn edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="showEditPointPopup(${point.id})">‚úèÔ∏è</button>
              <button class="action-btn calendar" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="selectPointForEditing(${point.id})">üìÖ</button>
              <button class="action-btn delete" title="–£–¥–∞–ª–∏—Ç—å" onclick="confirmDeletePoint(${point.id})">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
      
      listEl.innerHTML = html;
    }
    
    function renderEmployeesList() {
      const listEl = document.getElementById('employees-list');
      
      if (employees.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <h4>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h4>
            <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      employees.forEach(emp => {
        const empTags = employeeTags[emp.id] || [];
        const tagsHtml = empTags.map(pid => {
          const p = points.find(p => p.id === pid);
          return p ? `<span style="background: #1e40af; color: white; padding: 2px 6px; border-radius: 8px; font-size: 11px; margin-right: 4px;">${p.name}</span>` : '';
        }).join('');
        
        html += `
          <div class="employee-item">
            <div class="employee-info">
              <div class="employee-name">${emp.name}</div>
              <div class="employee-details">${emp.phone || ''} ‚Ä¢ ${emp.rate}‚ÇΩ/–¥–µ–Ω—å</div>
              <div style="margin-top: 6px; font-size: 11px; color: #64748b;">
                ${tagsHtml || '<span style="color: #94a3b8;">–ù–µ—Ç —Ç–µ–≥–æ–≤</span>'}
              </div>
            </div>
            <div class="employee-actions">
              <button class="action-btn edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="showEditEmployeePopup(${emp.id})">‚úèÔ∏è</button>
              <button class="action-btn delete" title="–£–¥–∞–ª–∏—Ç—å" onclick="confirmDeleteEmployee(${emp.id})">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
      
      listEl.innerHTML = html;
    }
    
    // ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê =====
    function updateStats() {
      document.getElementById('points-count').textContent = points.length;
      document.getElementById('employees-count').textContent = employees.length;
    }
    
    // ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // ===== –≠–ö–°–ü–û–†–¢ –í EXCEL =====
    function exportToExcel() {
      // –°–æ–∑–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
      const data = [];
      
      // –ó–∞–≥–æ–ª–æ–≤–∫–∏
      data.push(['–î–∞—Ç–∞', '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏', '–ê–¥—Ä–µ—Å', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', '–¢–µ–ª–µ—Ñ–æ–Ω', '–°—Ç–∞–≤–∫–∞']);
      
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ –¥–∞—Ç–µ
      const sortedSchedule = [...schedule].sort((a, b) => a.date.localeCompare(b.date));
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
      sortedSchedule.forEach(entry => {
        const point = points.find(p => p.id === entry.pointId);
        const employee = employees.find(e => e.id === entry.employeeId);
        
        if (point && employee) {
          data.push([
            entry.date,
            point.name,
            point.address,
            employee.name,
            employee.phone || '',
            employee.rate
          ]);
        }
      });
      
      // –°–æ–∑–¥–∞—ë–º CSV
      const csvContent = data.map(row => row.join(',')).join('\n');
      
      // –°–æ–∑–¥–∞—ë–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
      const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `grafik_pvz_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV!', 'success');
    }
  </script>
</body>
</html>

