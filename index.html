<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å –ü–í–ó</title>
  <style>
    /* ===== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #f0f9ff;
      color: #1e293b;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
    }
    
    /* ===== –•–ï–î–ï–† –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== */
    .header {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
    }
    
    .stat-item {
      background: #dbeafe;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 22px;
      font-weight: 600;
      color: #3b82f6;
    }
    
    .stat-label {
      font-size: 13px;
      color: #64748b;
      margin-top: 4px;
    }
    
    /* ===== –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô ===== */
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .btn {
      padding: 14px 10px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-align: center;
      min-height: 50px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-primary { background: #1e40af; }
    .btn-secondary { background: #7B99EC; }
    .btn-success { background: #1e40af; }
    .btn-warning { background: #7B99EC; }
    .btn-danger { background: #b91c1c; }
    .btn-back { background: #94a3b8; }
    .btn-edit { background: #f59e0b; }
    
    /* ===== –ö–ê–õ–ï–ù–î–ê–†–¨ ===== */
    .calendar-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      position: relative;
    }
    
    .point-select-container {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .point-select-btn {
      width: 100%;
      padding: 12px 20px;
      background: #031D5B;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .point-select-btn:hover {
      background: #052a7a;
      transform: translateY(-2px);
    }
    
    .calendar {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    
    .month-header {
      text-align: center;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 15px;
      color: #1e293b;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .month-nav {
      background: #1e40af;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background 0.2s;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .month-nav:hover {
      background: #1d4ed8;
    }
    
    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-weight: 500;
      color: #64748b;
      margin-bottom: 10px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    
    .day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      position: relative;
      overflow: hidden;
      background: #f1f5f9;
      color: #1e293b;
    }
    
    .day:hover {
      transform: scale(1.05);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .day.empty {
      background: transparent;
      cursor: default;
    }
    
    .day.free {
      background: #fee2e2;
      color: #b91c1c;
    }
    
    .day.busy {
      background: #dcfce7;
      color: #155e75;
    }
    
    .day.today {
      border: 2px solid #A6190D;
      background: #dbeafe !important;
      color: #A60505;
    }
    
    .day.today.free {
      background: #fecaca !important;
    }
    
    .day.today.busy {
      background: #bbf7d0 !important;
    }
    
    .day-number {
      position: relative;
      z-index: 1;
    }
    
    /* ===== –ü–û–ü-–ê–ü –û–ö–ù–ê ===== */
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .popup.active {
      opacity: 1;
      pointer-events: all;
    }
    
    .popup-content {
      background: white;
      border-radius: 12px;
      padding: 22px;
      width: 90%;
      max-width: 450px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      transform: translateY(20px);
      transition: transform 0.3s;
    }
    
    .popup.active .popup-content {
      transform: translateY(0);
    }
    
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .popup h3 {
      margin: 0;
      color: #1e293b;
      font-size: 18px;
      font-weight: 600;
    }
    
    .popup-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: #94a3b8;
      padding: 5px;
    }
    
    .popup-close:hover {
      color: #1e293b;
    }
    
    /* ===== –§–û–†–ú–´ ===== */
    .form-group {
      margin-bottom: 18px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #334155;
      font-size: 14px;
      font-weight: 500;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 15px;
      color: #1e293b;
      background: white;
      transition: border-color 0.2s;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #3b82f6;
    }
    
    .form-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 15px;
    }
    
    /* ===== –°–ü–ò–°–ö–ò –ü–£–ù–ö–¢–û–í –ò –°–û–¢–†–£–î–ù–ò–ö–û–í ===== */
    .points-list, .employees-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .point-item, .employee-item {
      background: white;
      padding: 12px 15px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s;
      border: 1px solid #e2e8f0;
    }
    
    .point-item:hover, .employee-item:hover {
      background: #f8fafc;
      border-color: #cbd5e1;
    }
    
    .point-info, .employee-info {
      flex: 1;
    }
    
    .point-name, .employee-name {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
      font-size: 15px;
    }
    
    .point-address, .employee-details {
      color: #64748b;
      font-size: 13px;
    }
    
    .point-actions, .employee-actions {
      display: flex;
      gap: 8px;
      min-width: 100px;
      justify-content: flex-end;
    }
    
    .action-btn {
      width: 36px !important;
      height: 36px !important;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px !important;
      transition: all 0.2s;
      padding: 0 !important;
      line-height: 1 !important;
    }
    
    .action-btn.delete {
      background: #fee2e2;
      color: #b91c1c;
    }
    
    .action-btn.edit {
      background: #fef3c7;
      color: #b45309;
    }
    
    /* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===== */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 2000;
      transition: transform 0.3s;
      font-weight: 500;
      color: #1e293b;
      border-left: 4px solid #3b82f6;
    }
    
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }
    
    .toast.success { border-left-color: #22c55e; }
    .toast.error { border-left-color: #ef4444; }
    .toast.warning { border-left-color: #f59e0b; }
    
    /* ===== –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø ===== */
    .confirm-popup {
      text-align: center;
      padding: 20px 0;
    }
    
    .confirm-popup p {
      margin-bottom: 20px;
      color: #64748b;
      font-size: 15px;
    }
    
    .confirm-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    /* ===== –ü–£–°–¢–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø ===== */
    .empty-state {
      text-align: center;
      color: #94a3b8;
      padding: 40px 20px;
    }
    
    .empty-state h4 {
      margin-bottom: 10px;
      color: #64748b;
    }
    
    .empty-state p {
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    /* ===== –¢–ï–ì–ò –°–û–¢–†–£–î–ù–ò–ö–û–í ===== */
    .tag-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .tag-btn {
      padding: 6px 12px;
      border: 1px solid #e2e8f0;
      background: #f1f5f9;
      color: #334155;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .tag-btn.selected {
      background: #1e40af;
      color: white;
      border-color: #1e40af;
    }
    
    .tag-btn:hover {
      background: #e2e8f0;
      color: #1e293b;
    }
    
    .recommended-badge {
      background: #f59e0b;
      color: white;
      padding: 3px 7px;
      border-radius: 10px;
      font-size: 11px;
      margin-left: 8px;
      font-weight: 500;
    }
    
    /* ===== –ö–ê–õ–ï–ù–î–ê–†–¨ –ù–ï–î–û–°–¢–£–ü–ï–ù ===== */
    .no-calendar {
      background: white;
      border-radius: 12px;
      padding: 30px 20px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    
    .no-calendar p {
      color: #64748b;
      font-size: 15px;
      margin-top: 10px;
    }
    
    .no-calendar-icon {
      font-size: 48px;
      margin-bottom: 15px;
      color: #94a3b8;
    }
    
    /* ===== –°–ï–ö–¶–ò–Ø –û–¢–ß–Å–¢–ê ===== */
    .report-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
    }
    
    .report-section .btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      background: #1e40af;
    }
    
    /* ===== –°–ï–ö–¶–ò–Ø –≠–ö–°–ü–û–†–¢–ê ===== */
    .export-section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      text-align: center;
    }
    
    .export-section .btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      background: #031D5B;
    }
    
    /* ===== –¢–ê–ë–õ–ò–¶–ê –û–¢–ß–Å–¢–ê (–£–õ–£–ß–®–ï–ù–ù–ê–Ø) ===== */
    .report-table-container {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-top: 15px;
      background: white;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      table-layout: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
    }
    
    th, td {
      border: 1px solid #e2e8f0;
      padding: 10px 12px;
      text-align: left;
      font-size: 14px;
      vertical-align: middle; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
      word-wrap: break-word; /* –ü–µ—Ä–µ–Ω–æ—Å –¥–ª–∏–Ω–Ω—ã—Ö —Å–ª–æ–≤ */
    }
    
    /* –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (1-2): —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –≤–µ—Ä—Ö—É */
    th:first-child, td:first-child,
    th:nth-child(2), td:nth-child(2) {
      vertical-align: top;
      white-space: normal;
    }
    
    /* –ß–∏—Å–ª–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ (3-5): –∑–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
    th:nth-child(3), th:nth-child(4), th:nth-child(5),
    td:nth-child(3), td:nth-child(4), td:nth-child(5) {
      white-space: nowrap; /* –ó–∞–ø—Ä–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–ª—è —á–∏—Å–µ–ª –∏ –∏—Ç–æ–≥–æ–≤ */
      text-align: right;
    }
    
    th {
      background: #dbeafe;
      font-weight: 600;
      color: #1e40af;
      white-space: nowrap; /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É */
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    tr:nth-child(even) {
      background: #f8fafc;
    }
    
    tr:hover {
      background: #edf2f7;
    }
    
    .report-total {
      font-weight: bold;
      background: #dbeafe !important;
      color: #1e40af !important;
    }
    
    .report-total td {
      vertical-align: middle !important;
    }
    
    /* –Ø—á–µ–π–∫–∞ "–í–°–ï–ì–û:" –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
    .report-total td:nth-child(3) {
      text-align: right !important;
    }
    
    /* ===== –í–´–ë–û–† –î–ê–¢–´ ===== */
    .date-picker {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .date-picker label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #334155;
    }
    
    .date-picker input {
      width: 100%;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="stats">
        <div class="stat-item">
          <div class="stat-number" id="points-count">0</div>
          <div class="stat-label">–ü—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="employees-count">0</div>
          <div class="stat-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
        </div>
      </div>
    </div>
    
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="showAddPointPopup()">
        –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏
      </button>
      <button class="btn btn-secondary" onclick="showAddEmployeePopup()">
        –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
      </button>
      <button class="btn btn-success" onclick="showPointsList()">
        –ú–æ–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏
      </button>
      <button class="btn btn-warning" onclick="showEmployeesList()">
        –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
      </button>
    </div>
    
    <div class="calendar-container">
      <div class="point-select-container">
        <button class="point-select-btn" onclick="showPointsListForCalendar()">
          <span>üìç</span>
          <span id="selected-point-name">–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</span>
        </button>
      </div>
      
      <div id="calendar-placeholder" class="no-calendar">
        <div class="no-calendar-icon">üìÖ</div>
        <h3>–ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</h3>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞</p>
      </div>
      
      <div id="calendar-content" style="display: none;">
        <div class="calendar">
          <div class="month-header">
            <button class="month-nav" onclick="changeMonth(-1)">‚ùÆ</button>
            <div id="month-name">–Ø–Ω–≤–∞—Ä—å 2026</div>
            <button class="month-nav" onclick="changeMonth(1)">‚ùØ</button>
          </div>
          <div class="weekdays">
            <div>–ü–Ω</div>
            <div>–í—Ç</div>
            <div>–°—Ä</div>
            <div>–ß—Ç</div>
            <div>–ü—Ç</div>
            <div>–°–±</div>
            <div>–í—Å</div>
          </div>
          <div class="days" id="days-container">
            <!-- –î–Ω–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á—ë—Ç–∞ -->
    <div class="report-section">
      <button class="btn btn-primary" onclick="showReportPopup()">üìä –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç</button>
    </div>
    
    <div class="export-section">
      <button class="btn btn-warning" onclick="exportToExcel()">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ü–í–ó (–¢–û–õ–¨–ö–û –ê–î–†–ï–°) -->
  <div class="popup" id="add-point-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="point-popup-title">–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</h3>
        <button class="popup-close" onclick="closePopup('add-point-popup')">√ó</button>
      </div>
      <div class="form-group">
        <label for="point-address">–ê–¥—Ä–µ—Å –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ *</label>
        <input type="text" id="point-address" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, 10" maxlength="200">
      </div>
      <div class="form-actions">
        <button class="btn btn-back" onclick="closePopup('add-point-popup')">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" id="point-save-btn" onclick="savePoint()">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
  <div class="popup" id="add-employee-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="employee-popup-title">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <button class="popup-close" onclick="closePopup('add-employee-popup')">√ó</button>
      </div>
      <div class="form-group">
        <label for="employee-name">–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ *</label>
        <input type="text" id="employee-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" maxlength="100">
      </div>
      <div class="form-group">
        <label for="employee-phone">–¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input type="tel" id="employee-phone" placeholder="+7 (123) 456-78-90" maxlength="20" 
               oninput="validatePhone(this)">
      </div>
      <div class="form-group">
        <label for="employee-rate">–°—Ç–∞–≤–∫–∞ –∑–∞ –¥–µ–Ω—å (‚ÇΩ)</label>
        <input type="number" id="employee-rate" placeholder="1000" value="1000" min="0">
      </div>
      <div class="form-group">
        <label>–¢–µ–≥–∏ –ø–æ –ø—É–Ω–∫—Ç–∞–º (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)</label>
        <div class="tag-selector" id="point-tags-selector">
          <!-- –¢–µ–≥–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
        </div>
      </div>
      <div class="form-actions">
        <button class="btn btn-back" onclick="closePopup('add-employee-popup')">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-secondary" id="employee-save-btn" onclick="saveEmployee()">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø —Å–ø–∏—Å–∫–∞ –ü–í–ó -->
  <div class="popup" id="points-list-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="points-list-title">–ú–æ–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h3>
        <button class="popup-close" onclick="closePopup('points-list-popup')">√ó</button>
      </div>
      <div class="points-list" id="points-list">
        <!-- –°–ø–∏—Å–æ–∫ –ü–í–ó –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
  <div class="popup" id="employees-list-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h3>
        <button class="popup-close" onclick="closePopup('employees-list-popup')">√ó</button>
      </div>
      <div class="employees-list" id="employees-list">
        <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è -->
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
  <div class="popup" id="confirm-delete-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <button class="popup-close" onclick="closePopup('confirm-delete-popup')">√ó</button>
      </div>
      <div class="confirm-popup">
        <p id="confirm-delete-message">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç?</p>
        <div class="confirm-actions">
          <button class="btn btn-back" onclick="closePopup('confirm-delete-popup')">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-danger" id="confirm-delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–∞ -->
  <div class="popup" id="confirm-duplicate-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–í–Ω–∏–º–∞–Ω–∏–µ</h3>
        <button class="popup-close" onclick="closePopup('confirm-duplicate-popup')">√ó</button>
      </div>
      <div class="confirm-popup">
        <p id="confirm-duplicate-message">–¢–∞–∫–æ–π –ø—É–Ω–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?</p>
        <div class="confirm-actions">
          <button class="btn btn-back" onclick="closePopup('confirm-duplicate-popup')">–û—Ç–º–µ–Ω–∞</button>
          <button class="btn btn-primary" id="confirm-add-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –¥–Ω—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
  <div class="popup" id="day-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3 id="popup-date">27 —è–Ω–≤–∞—Ä—è</h3>
        <button class="popup-close" onclick="closePopup('day-popup')">√ó</button>
      </div>
      <div style="text-align: center; padding: 20px;">
        <div style="font-size: 42px; margin-bottom: 15px; color: #64748b;">üìÖ</div>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 15px;">
          –í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã
        </p>
        <div id="day-employees-list">
          <!-- –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞ -->
        </div>
        <div id="day-assigned-employee" style="display: none; margin-top: 20px;">
          <p style="color: #22c55e; font-weight: 600; margin-bottom: 10px;">‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω:</p>
          <div id="assigned-employee-name" style="font-size: 17px; margin-bottom: 15px; color: #1e293b;"></div>
          <div style="display: flex; justify-content: center;">
            <button class="btn btn-danger" onclick="clearDayAssignment()">–û—á–∏—Å—Ç–∏—Ç—å –¥–µ–Ω—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –ü–æ–ø-–∞–ø –æ—Ç—á—ë—Ç–∞ -->
  <div class="popup" id="report-popup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>–°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ</h3>
        <button class="popup-close" onclick="closePopup('report-popup')">√ó</button>
      </div>
      
      <div class="date-picker">
        <div class="form-group">
          <label for="report-start-date">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞</label>
          <input type="date" id="report-start-date">
        </div>
        <div class="form-group">
          <label for="report-end-date">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞</label>
          <input type="date" id="report-end-date">
        </div>
      </div>
      
      <div class="form-group">
        <label for="report-point">–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏</label>
        <select id="report-point" class="form-control">
          <option value="all">–í—Å–µ –ø—É–Ω–∫—Ç—ã</option>
          <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </select>
      </div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-primary" onclick="generateReport()">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
      </div>
      
      <div id="report-result" style="margin-top: 25px; display: none;">
        <h4 style="margin-bottom: 15px; color: #1e40af;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—á—ë—Ç–∞</h4>
        <div class="report-table-container">
          <table id="report-table">
            <thead>
              <tr>
                <th>–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</th>
                <th>–ü—É–Ω–∫—Ç</th>
                <th>–ö–æ–ª-–≤–æ —Å–º–µ–Ω</th>
                <th>–°—Ç–∞–≤–∫–∞</th>
                <th>–ò—Ç–æ–≥–æ</th>
              </tr>
            </thead>
            <tbody id="report-table-body">
              <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
            </tbody>
            <tfoot>
              <tr class="report-total">
                <td colspan="2"></td>
                <td style="text-align: right;">–í–°–ï–ì–û:</td>
                <td id="report-total-count">0</td>
                <td id="report-total-sum">0 ‚ÇΩ</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
          <button class="btn btn-warning" onclick="exportReportToExcel()">üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
  <div class="toast" id="toast"></div>
  
  <script>
    // ===== –•–†–ê–ù–ò–õ–ò–©–ï –î–ê–ù–ù–´–• (localStorage) =====
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();
    let currentPointId = null;
    let points = JSON.parse(localStorage.getItem('pvz_points')) || [];
    let employees = JSON.parse(localStorage.getItem('pvz_employees')) || [];
    let schedule = JSON.parse(localStorage.getItem('pvz_schedule')) || [];
    let employeeTags = JSON.parse(localStorage.getItem('pvz_employee_tags')) || {};
    let editingPointId = null;
    let editingEmployeeId = null;
    
    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
    document.addEventListener('DOMContentLoaded', () => {
      updateStats();
      updateCalendarView();
      setupReportDates();
    });
    
    // ===== –í–ê–õ–ò–î–ê–¶–ò–Ø –¢–ï–õ–ï–§–û–ù–ê =====
    function validatePhone(input) {
      let value = input.value.replace(/[^+0-9() -]/g, '');
      
      if (value.length > 20) {
        value = value.substring(0, 20);
      }
      
      if (value.startsWith('+7') && value.length === 3) {
        value += ' (';
      } else if (value.startsWith('+7 (') && value.length === 6) {
        value += ')';
      } else if (value.startsWith('+7 ()') && value.length === 7) {
        value = '+7 (';
      } else if (value.startsWith('+7 (') && value.length === 10) {
        value += ' ';
      } else if (value.startsWith('+7 (') && value.length === 14) {
        value += '-';
      } else if (value.startsWith('+7 (') && value.length === 17) {
        value += '-';
      }
      
      input.value = value;
    }
    
    // ===== –ö–ê–õ–ï–ù–î–ê–†–¨ =====
    const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å",
      "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
    
    function generateCalendar(year, month) {
      currentYear = year;
      currentMonth = month;
      
      document.getElementById('month-name').textContent = `${monthNames[month]} ${year}`;
      
      const daysContainer = document.getElementById('days-container');
      daysContainer.innerHTML = '';
      
      const firstDay = new Date(year, month, 1).getDay() || 7;
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      const isCurrentMonth = year === today.getFullYear() && month === today.getMonth();
      
      for (let i = 1; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.className = 'day empty';
        daysContainer.appendChild(empty);
      }
      
      for (let day = 1; day <= daysInMonth; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayEl.appendChild(dayNumber);
        
        const dateStr = formatDate(year, month, day);
        
        const isScheduled = currentPointId && schedule.some(s => 
          s.pointId === currentPointId && s.date === dateStr
        );
        
        dayEl.classList.add(isScheduled ? 'busy' : 'free');
        
        if (isCurrentMonth && day === today.getDate()) {
          dayEl.classList.add('today');
        }
        
        if (currentPointId) {
          dayEl.onclick = () => showDayPopup(day, month, year);
        }
        
        daysContainer.appendChild(dayEl);
      }
    }
    
    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      generateCalendar(currentYear, currentMonth);
    }
    
    function formatDate(year, month, day) {
      return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    }
    
    // ===== –ü–û–ü-–ê–ü –û–ö–ù–ê =====
    function showPopup(id) {
      document.getElementById(id).classList.add('active');
    }
    
    function closePopup(id) {
      document.getElementById(id).classList.remove('active');
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –ü–í–ó (–¢–û–õ–¨–ö–û –ê–î–†–ï–°) =====
    function showAddPointPopup() {
      editingPointId = null;
      document.getElementById('point-address').value = '';
      document.getElementById('point-popup-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏';
      document.getElementById('point-save-btn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
      document.getElementById('point-save-btn').className = 'btn btn-primary';
      showPopup('add-point-popup');
    }
    
    function showEditPointPopup(pointId) {
      const point = points.find(p => p.id === pointId);
      if (!point) return;
      
      editingPointId = pointId;
      document.getElementById('point-address').value = point.address;
      document.getElementById('point-popup-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏';
      document.getElementById('point-save-btn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      document.getElementById('point-save-btn').className = 'btn btn-edit';
      
      closePopup('points-list-popup');
      showPopup('add-point-popup');
    }
    
    function savePoint() {
      const address = document.getElementById('point-address').value.trim();
      
      if (!address || address.length < 5) {
        showToast('–ê–¥—Ä–µ—Å –ü–í–ó –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (editingPointId) {
        const index = points.findIndex(p => p.id === editingPointId);
        if (index !== -1) {
          points[index].name = address;
          points[index].address = address;
          localStorage.setItem('pvz_points', JSON.stringify(points));
          closePopup('add-point-popup');
          showToast('‚úÖ –ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
          renderPointsList();
          updateCalendarView();
        }
      } else {
        addPoint();
      }
    }
    
    function addPoint() {
      const address = document.getElementById('point-address').value.trim();
      
      if (!address || address.length < 5) {
        showToast('–ê–¥—Ä–µ—Å –ü–í–ó –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      const existingPoint = points.find(p => p.address.toLowerCase() === address.toLowerCase());
      
      if (existingPoint) {
        document.getElementById('confirm-duplicate-message').textContent = 
          `–ü—É–Ω–∫—Ç —Å –∞–¥—Ä–µ—Å–æ–º "${address}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?`;
        
        document.getElementById('confirm-add-btn').onclick = () => {
          doAddPoint(address);
          closePopup('confirm-duplicate-popup');
        };
        
        showPopup('confirm-duplicate-popup');
        return;
      }
      
      doAddPoint(address);
    }
    
    function doAddPoint(address) {
      const newPoint = {
        id: points.length > 0 ? Math.max(...points.map(p => p.id)) + 1 : 1,
        name: address,
        address: address
      };
      
      points.push(newPoint);
      localStorage.setItem('pvz_points', JSON.stringify(points));
      
      closePopup('add-point-popup');
      showToast('‚úÖ –ü–í–ó –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
      updateStats();
      renderPointsList();
      updateCalendarView();
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –°–û–¢–†–£–î–ù–ò–ö–û–í =====
    function showAddEmployeePopup() {
      editingEmployeeId = null;
      document.getElementById('employee-name').value = '';
      document.getElementById('employee-phone').value = '';
      document.getElementById('employee-rate').value = '1000';
      document.getElementById('employee-popup-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
      document.getElementById('employee-save-btn').textContent = '–î–æ–±–∞–≤–∏—Ç—å';
      document.getElementById('employee-save-btn').className = 'btn btn-secondary';
      
      const tagsContainer = document.getElementById('point-tags-selector');
      if (points.length === 0) {
        tagsContainer.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</p>';
      } else {
        let html = '';
        points.forEach(point => {
          html += `
            <button class="tag-btn" onclick="toggleTag(this, ${point.id})">
              ${point.name}
            </button>
          `;
        });
        tagsContainer.innerHTML = html;
      }
      
      showPopup('add-employee-popup');
    }
    
    function showEditEmployeePopup(employeeId) {
      const employee = employees.find(e => e.id === employeeId);
      if (!employee) return;
      
      editingEmployeeId = employeeId;
      document.getElementById('employee-name').value = employee.name;
      document.getElementById('employee-phone').value = employee.phone || '';
      document.getElementById('employee-rate').value = employee.rate;
      document.getElementById('employee-popup-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞';
      document.getElementById('employee-save-btn').textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
      document.getElementById('employee-save-btn').className = 'btn btn-edit';
      
      const tagsContainer = document.getElementById('point-tags-selector');
      if (points.length === 0) {
        tagsContainer.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</p>';
      } else {
        let html = '';
        points.forEach(point => {
          const isSelected = employeeTags[employeeId] && employeeTags[employeeId].includes(point.id);
          html += `
            <button class="tag-btn ${isSelected ? 'selected' : ''}" onclick="toggleTag(this, ${point.id})">
              ${point.name}
            </button>
          `;
        });
        tagsContainer.innerHTML = html;
      }
      
      closePopup('employees-list-popup');
      showPopup('add-employee-popup');
    }
    
    function saveEmployee() {
      const name = document.getElementById('employee-name').value.trim();
      const phone = document.getElementById('employee-phone').value.trim();
      const rate = parseFloat(document.getElementById('employee-rate').value) || 1000;
      
      if (!name || name.length < 2) {
        showToast('–§–ò–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      if (editingEmployeeId) {
        const index = employees.findIndex(e => e.id === editingEmployeeId);
        if (index !== -1) {
          employees[index].name = name;
          employees[index].phone = phone;
          employees[index].rate = rate;
          
          const selectedTags = Array.from(document.querySelectorAll('#point-tags-selector .tag-btn.selected'));
          const tags = selectedTags.map(btn => parseInt(btn.getAttribute('onclick').match(/\d+/)[0]));
          if (tags.length > 0) {
            employeeTags[editingEmployeeId] = tags;
          } else {
            delete employeeTags[editingEmployeeId];
          }
          
          localStorage.setItem('pvz_employees', JSON.stringify(employees));
          localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
          
          closePopup('add-employee-popup');
          showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ–±–Ω–æ–≤–ª—ë–Ω!', 'success');
          renderEmployeesList();
        }
      } else {
        addEmployee();
      }
    }
    
    function addEmployee() {
      const name = document.getElementById('employee-name').value.trim();
      const phone = document.getElementById('employee-phone').value.trim();
      const rate = parseFloat(document.getElementById('employee-rate').value) || 1000;
      
      if (!name || name.length < 2) {
        showToast('–§–ò–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
        return;
      }
      
      const existingEmployee = employees.find(e => e.name.toLowerCase() === name.toLowerCase());
      
      if (existingEmployee) {
        document.getElementById('confirm-duplicate-message').textContent = 
          `–°–æ—Ç—Ä—É–¥–Ω–∏–∫ "${name}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ä–∞–∑?`;
        
        document.getElementById('confirm-add-btn').onclick = () => {
          doAddEmployee(name, phone, rate);
          closePopup('confirm-duplicate-popup');
        };
        
        showPopup('confirm-duplicate-popup');
        return;
      }
      
      doAddEmployee(name, phone, rate);
    }
    
    function doAddEmployee(name, phone, rate) {
      const newEmployee = {
        id: employees.length > 0 ? Math.max(...employees.map(e => e.id)) + 1 : 1,
        name: name,
        phone: phone,
        rate: rate
      };
      
      employees.push(newEmployee);
      
      const selectedTags = Array.from(document.querySelectorAll('#point-tags-selector .tag-btn.selected'));
      const tags = selectedTags.map(btn => parseInt(btn.getAttribute('onclick').match(/\d+/)[0]));
      if (tags.length > 0) {
        employeeTags[newEmployee.id] = tags;
      }
      
      localStorage.setItem('pvz_employees', JSON.stringify(employees));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      closePopup('add-employee-popup');
      showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
      updateStats();
      renderEmployeesList();
    }
    
    function toggleTag(btn, pointId) {
      btn.classList.toggle('selected');
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –°–ü–ò–°–ö–û–í =====
    function showPointsList() {
      document.getElementById('points-list-title').textContent = '–ú–æ–∏ –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏';
      renderPointsList();
      showPopup('points-list-popup');
    }
    
    function showPointsListForCalendar() {
      document.getElementById('points-list-title').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞';
      renderPointsListForCalendar();
      showPopup('points-list-popup');
    }
    
    function showEmployeesList() {
      renderEmployeesList();
      showPopup('employees-list-popup');
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –ö–ê–õ–ï–ù–î–ê–†–Ø –ò –î–ù–Ø =====
    function showDayPopup(day, month, year) {
      const dateStr = formatDate(year, month, day);
      document.getElementById('popup-date').textContent = `${day} ${monthNames[month].toLowerCase()} ${year}`;
      
      const listEl = document.getElementById('day-employees-list');
      const assignedEl = document.getElementById('day-assigned-employee');
      const assignedNameEl = document.getElementById('assigned-employee-name');
      
      const existing = schedule.find(s => s.pointId === currentPointId && s.date === dateStr);
      
      if (existing) {
        const employee = employees.find(e => e.id === existing.employeeId);
        assignedNameEl.textContent = employee ? employee.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
        assignedEl.style.display = 'block';
        listEl.style.display = 'none';
      } else {
        assignedEl.style.display = 'none';
        listEl.style.display = 'block';
        
        if (employees.length === 0) {
          listEl.innerHTML = '<p style="color: #94a3b8;">–°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>';
        } else {
          const sortedEmployees = [...employees].sort((a, b) => {
            const aHasTag = employeeTags[a.id] && employeeTags[a.id].includes(currentPointId);
            const bHasTag = employeeTags[b.id] && employeeTags[b.id].includes(currentPointId);
            return bHasTag - aHasTag;
          });
          
          let html = '';
          sortedEmployees.forEach(emp => {
            const isRecommended = employeeTags[emp.id] && employeeTags[emp.id].includes(currentPointId);
            html += `
              <div class="employee-item" onclick="assignEmployeeToDay(${emp.id}, '${dateStr}')">
                <div class="employee-info">
                  <div class="employee-name">
                    ${emp.name}
                    ${isRecommended ? '<span class="recommended-badge">‚òÖ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω</span>' : ''}
                  </div>
                  <div class="employee-details">${emp.phone || ''} ‚Ä¢ ${emp.rate}‚ÇΩ/–¥–µ–Ω—å</div>
                </div>
                <div style="font-size: 20px; color: #64748b;">‚û°Ô∏è</div>
              </div>
            `;
          });
          listEl.innerHTML = html;
        }
      }
      
      showPopup('day-popup');
    }
    
    function assignEmployeeToDay(employeeId, dateStr) {
      if (!currentPointId) {
        showToast('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏', 'error');
        return;
      }
      
      schedule = schedule.filter(s => !(s.pointId === currentPointId && s.date === dateStr));
      
      schedule.push({
        pointId: currentPointId,
        employeeId: employeeId,
        date: dateStr
      });
      
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      
      const employee = employees.find(e => e.id === employeeId);
      showToast(`üìÖ ${employee.name} –Ω–∞–∑–Ω–∞—á–µ–Ω –Ω–∞ ${dateStr}`, 'success');
      closePopup('day-popup');
      generateCalendar(currentYear, currentMonth);
    }
    
    function clearDayAssignment() {
      const dateStr = document.getElementById('popup-date').textContent;
      const [day, monthName, year] = dateStr.split(' ');
      const monthIndex = monthNames.findIndex(m => m.toLowerCase() === monthName);
      const fullDate = formatDate(parseInt(year), monthIndex, parseInt(day));
      
      schedule = schedule.filter(s => !(s.pointId === currentPointId && s.date === fullDate));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      
      showToast('‚úÖ –î–µ–Ω—å –æ—á–∏—â–µ–Ω', 'success');
      closePopup('day-popup');
      generateCalendar(currentYear, currentMonth);
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –£–î–ê–õ–ï–ù–ò–Ø =====
    function confirmDeletePoint(pointId) {
      const point = points.find(p => p.id === pointId);
      document.getElementById('confirm-delete-message').textContent = 
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${point.name}"? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`;
      
      document.getElementById('confirm-delete-btn').onclick = () => {
        deletePoint(pointId);
        closePopup('confirm-delete-popup');
      };
      
      showPopup('confirm-delete-popup');
    }
    
    function deletePoint(pointId) {
      points = points.filter(p => p.id !== pointId);
      schedule = schedule.filter(s => s.pointId !== pointId);
      
      for (let empId in employeeTags) {
        employeeTags[empId] = employeeTags[empId].filter(pid => pid !== pointId);
        if (employeeTags[empId].length === 0) {
          delete employeeTags[empId];
        }
      }
      
      localStorage.setItem('pvz_points', JSON.stringify(points));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      if (currentPointId === pointId) {
        currentPointId = null;
        updateCalendarView();
      }
      
      showToast('‚úÖ –ü–í–ó —É–¥–∞–ª—ë–Ω!', 'success');
      updateStats();
      renderPointsList();
    }
    
    function confirmDeleteEmployee(employeeId) {
      const employee = employees.find(e => e.id === employeeId);
      document.getElementById('confirm-delete-message').textContent = 
        `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${employee.name}"? –í—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥—Ä–∞—Ñ–∏–∫–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.`;
      
      document.getElementById('confirm-delete-btn').onclick = () => {
        deleteEmployee(employeeId);
        closePopup('confirm-delete-popup');
      };
      
      showPopup('confirm-delete-popup');
    }
    
    function deleteEmployee(employeeId) {
      employees = employees.filter(e => e.id !== employeeId);
      schedule = schedule.filter(s => s.employeeId !== employeeId);
      delete employeeTags[employeeId];
      
      localStorage.setItem('pvz_employees', JSON.stringify(employees));
      localStorage.setItem('pvz_schedule', JSON.stringify(schedule));
      localStorage.setItem('pvz_employee_tags', JSON.stringify(employeeTags));
      
      showToast('‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–¥–∞–ª—ë–Ω!', 'success');
      updateStats();
      renderEmployeesList();
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –í–´–ë–û–†–ê –ü–í–ó =====
    function selectPointForEditing(pointId) {
      const point = points.find(p => p.id === pointId);
      currentPointId = pointId;
      
      document.getElementById('selected-point-name').textContent = point.name;
      updateCalendarView();
      closePopup('points-list-popup');
      showToast(`‚úÖ –í—ã–±—Ä–∞–Ω: ${point.name}`, 'success');
    }
    
    function updateCalendarView() {
      const placeholder = document.getElementById('calendar-placeholder');
      const content = document.getElementById('calendar-content');
      const selectBtn = document.getElementById('selected-point-name');
      
      if (!currentPointId) {
        placeholder.style.display = 'block';
        content.style.display = 'none';
        selectBtn.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏';
      } else {
        const point = points.find(p => p.id === currentPointId);
        selectBtn.textContent = point.name;
        
        placeholder.style.display = 'none';
        content.style.display = 'block';
        
        generateCalendar(currentYear, currentMonth);
      }
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–ü–ò–°–ö–û–í =====
    function renderPointsList() {
      const listEl = document.getElementById('points-list');
      
      if (points.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <h4>–ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h4>
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      points.forEach(point => {
        html += `
          <div class="point-item">
            <div class="point-info" onclick="selectPointForEditing(${point.id})">
              <div class="point-name">${point.address}</div>
            </div>
            <div class="point-actions">
              <button class="action-btn edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="showEditPointPopup(${point.id})">‚úèÔ∏è</button>
              <button class="action-btn delete" title="–£–¥–∞–ª–∏—Ç—å" onclick="confirmDeletePoint(${point.id})">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
      
      listEl.innerHTML = html;
    }
    
    function renderPointsListForCalendar() {
      const listEl = document.getElementById('points-list');
      
      if (points.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <h4>–ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h4>
            <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      points.forEach(point => {
        html += `
          <div class="point-item">
            <div class="point-info" onclick="selectPointForEditing(${point.id})">
              <div class="point-name">${point.address}</div>
            </div>
          </div>
        `;
      });
      
      listEl.innerHTML = html;
    }
    
    function renderEmployeesList() {
      const listEl = document.getElementById('employees-list');
      
      if (employees.length === 0) {
        listEl.innerHTML = `
          <div class="empty-state">
            <h4>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h4>
            <p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      employees.forEach(emp => {
        const empTags = employeeTags[emp.id] || [];
        const tagsHtml = empTags.map(pid => {
          const p = points.find(p => p.id === pid);
          return p ? `<span style="background: #1e40af; color: white; padding: 2px 6px; border-radius: 8px; font-size: 11px; margin-right: 4px;">${p.name}</span>` : '';
        }).join('');
        
        html += `
          <div class="employee-item">
            <div class="employee-info">
              <div class="employee-name">${emp.name}</div>
              <div class="employee-details">${emp.phone || ''} ‚Ä¢ ${emp.rate}‚ÇΩ/–¥–µ–Ω—å</div>
              <div style="margin-top: 6px; font-size: 11px; color: #64748b;">
                ${tagsHtml || '<span style="color: #94a3b8;">–ù–µ—Ç —Ç–µ–≥–æ–≤</span>'}
              </div>
            </div>
            <div class="employee-actions">
              <button class="action-btn edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" onclick="showEditEmployeePopup(${emp.id})">‚úèÔ∏è</button>
              <button class="action-btn delete" title="–£–¥–∞–ª–∏—Ç—å" onclick="confirmDeleteEmployee(${emp.id})">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
      
      listEl.innerHTML = html;
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô =====
    function updateStats() {
      document.getElementById('points-count').textContent = points.length;
      document.getElementById('employees-count').textContent = employees.length;
    }
    
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –≠–ö–°–ü–û–†–¢–ê (–ò–°–ü–†–ê–í–õ–ï–ù–û: –ö–û–†–†–ï–ö–¢–ù–ê–Ø –ö–û–î–ò–†–û–í–ö–ê –ò –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï) =====
    function exportToExcel() {
      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º –¥–ª—è Excel (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–µ!)
      let csvContent = 'sep=,\r\n';
      
      // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–∞–≤—ã—á–µ–∫
      const headers = ['–î–∞—Ç–∞', '–ü—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏', '–ê–¥—Ä–µ—Å', '–°–æ—Ç—Ä—É–¥–Ω–∏–∫', '–¢–µ–ª–µ—Ñ–æ–Ω', '–°—Ç–∞–≤–∫–∞'];
      csvContent += headers.map(cell => `"${cell.replace(/"/g, '""')}"`).join(',') + '\r\n';
      
      // –î–∞–Ω–Ω—ã–µ —Å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
      const sortedSchedule = [...schedule].sort((a, b) => a.date.localeCompare(b.date));
      
      sortedSchedule.forEach(entry => {
        const point = points.find(p => p.id === entry.pointId);
        const employee = employees.find(e => e.id === entry.employeeId);
        
        if (point && employee) {
          // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∫–∞–≤—ã—á–∫–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –∫–∞–≤—ã—á–∫–∏
          const row = [
            entry.date,
            point.name.replace(/"/g, '""'),
            point.address.replace(/"/g, '""'),
            employee.name.replace(/"/g, '""'),
            (employee.phone || '').replace(/"/g, '""'),
            employee.rate
          ];
          csvContent += row.map(cell => `"${cell}"`).join(',') + '\r\n';
        }
      });
      
      // –°–æ–∑–¥–∞—ë–º Blob —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8 —Å BOM
      const blob = new Blob(['\ufeff' + csvContent], { 
        type: 'text/csv;charset=utf-8;'
      });
      
      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `grafik_pvz_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ CSV!', 'success');
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –û–¢–ß–Å–¢–ê =====
    function setupReportDates() {
      const today = new Date();
      const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
      const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
      
      document.getElementById('report-start-date').valueAsDate = firstDay;
      document.getElementById('report-end-date').valueAsDate = lastDay;
    }
    
    function showReportPopup() {
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç –ø—É–Ω–∫—Ç–∞–º–∏
      const pointSelect = document.getElementById('report-point');
      pointSelect.innerHTML = '<option value="all">–í—Å–µ –ø—É–Ω–∫—Ç—ã</option>';
      
      points.forEach(point => {
        const option = document.createElement('option');
        option.value = point.id;
        option.textContent = point.name;
        pointSelect.appendChild(option);
      });
      
      // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç—á—ë—Ç–∞
      document.getElementById('report-result').style.display = 'none';
      
      showPopup('report-popup');
    }
    
    function generateReport() {
      const startDateStr = document.getElementById('report-start-date').value;
      const endDateStr = document.getElementById('report-end-date').value;
      const pointFilter = document.getElementById('report-point').value;
      
      if (!startDateStr || !endDateStr) {
        showToast('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—ã –¥–ª—è –æ—Ç—á—ë—Ç–∞', 'error');
        return;
      }
      
      const startDate = new Date(startDateStr);
      const endDate = new Date(endDateStr);
      
      // –§–∏–ª—å—Ç—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –ø–æ –¥–∞—Ç–∞–º –∏ –ø—É–Ω–∫—Ç—É
      const filteredSchedule = schedule.filter(entry => {
        const entryDate = new Date(entry.date);
        const inDateRange = entryDate >= startDate && entryDate <= endDate;
        const matchesPoint = pointFilter === 'all' || entry.pointId === parseInt(pointFilter);
        return inDateRange && matchesPoint;
      });
      
      if (filteredSchedule.length === 0) {
        showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥', 'warning');
        document.getElementById('report-result').style.display = 'none';
        return;
      }
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –∏ –ø—É–Ω–∫—Ç—É
      const reportMap = new Map();
      
      filteredSchedule.forEach(entry => {
        const employee = employees.find(e => e.id === entry.employeeId);
        const point = points.find(p => p.id === entry.pointId);
        
        if (!employee || !point) return;
        
        const key = `${entry.employeeId}_${entry.pointId}`;
        
        if (!reportMap.has(key)) {
          reportMap.set(key, {
            employeeName: employee.name,
            pointName: point.name,
            pointId: entry.pointId,
            employeeId: entry.employeeId,
            count: 0,
            rate: employee.rate
          });
        }
        
        reportMap.get(key).count++;
      });
      
      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
      const reportData = Array.from(reportMap.values()).sort((a, b) => 
        a.employeeName.localeCompare(b.employeeName)
      );
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
      renderReportTable(reportData);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      document.getElementById('report-result').style.display = 'block';
    }
    
    function renderReportTable(data) {
      const tableBody = document.getElementById('report-table-body');
      tableBody.innerHTML = '';
      
      let totalCount = 0;
      let totalSum = 0;
      
      data.forEach(item => {
        const row = document.createElement('tr');
        const total = item.count * item.rate;
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const formattedCount = item.count;
        const formattedRate = `${item.rate} ‚ÇΩ`;
        const formattedTotal = `${total.toFixed(2)} ‚ÇΩ`;
        
        row.innerHTML = `
          <td>${item.employeeName}</td>
          <td>${item.pointName}</td>
          <td>${formattedCount}</td>
          <td>${formattedRate}</td>
          <td>${formattedTotal}</td>
        `;
        
        tableBody.appendChild(row);
        
        totalCount += item.count;
        totalSum += total;
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–∏
      document.getElementById('report-total-count').textContent = totalCount;
      document.getElementById('report-total-sum').textContent = `${totalSum.toFixed(2)} ‚ÇΩ`;
    }
    
    function exportReportToExcel() {
      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º –¥–ª—è Excel
      let csvContent = 'sep=,\r\n';
      
      // –ó–∞–≥–æ–ª–æ–≤–∫–∏
      const headers = ['–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', '–ü—É–Ω–∫—Ç', '–ö–æ–ª-–≤–æ —Å–º–µ–Ω', '–°—Ç–∞–≤–∫–∞', '–ò—Ç–æ–≥–æ'];
      csvContent += headers.map(cell => `"${cell.replace(/"/g, '""')}"`).join(',') + '\r\n';
      
      // –î–∞–Ω–Ω—ã–µ
      const table = document.getElementById('report-table');
      const rows = table.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = Array.from(cells).map(cell => 
          cell.textContent.trim().replace(/"/g, '""')
        );
        csvContent += rowData.map(cell => `"${cell}"`).join(',') + '\r\n';
      });
      
      // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
      csvContent += '\r\n';
      
      // –ò—Ç–æ–≥–∏
      const totalRow = table.querySelector('tfoot tr');
      const totalCells = totalRow.querySelectorAll('td');
      const totalData = Array.from(totalCells).map(cell => 
        cell.textContent.trim().replace(/"/g, '""')
      );
      csvContent += totalData.map(cell => `"${cell}"`).join(',') + '\r\n';
      
      // –°–æ–∑–¥–∞—ë–º Blob —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8 —Å BOM
      const blob = new Blob(['\ufeff' + csvContent], { 
        type: 'text/csv;charset=utf-8;'
      });
      
      // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `otchet_zarplata_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‚úÖ –û—Ç—á—ë—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ CSV!', 'success');
    }
  </script>
</body>
</html>
